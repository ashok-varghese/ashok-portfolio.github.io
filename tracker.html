<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Attendance Tracker</title>
  <style>
    body { font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; max-width: 1100px; margin: 0 auto; padding: 20px; line-height: 1.5; }
    h1 { text-align: center; color: #1a73e8; margin-bottom: 30px; }
    .section { background: white; margin: 20px 0; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .grid-cols-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .grid-cols-7 { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; }
    label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
    input[type="number"], input[type="date"], select { width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
    input:focus, select:focus { outline: none; border-color: #1a73e8; box-shadow: 0 0 0 3px rgba(26,115,232,0.1); }
    button { background: #1a73e8; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 600; transition: all 0.2s; }
    button:hover { background: #1557b0; transform: translateY(-1px); }
    button.danger { background: #ea4335; }
    button.danger:hover { background: #d93025; }
    button.secondary { background: #34a853; }
    button.success { background: #34a853; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
    th { background: #f8f9fa; padding: 12px; text-align: center; font-weight: 600; border-bottom: 2px solid #e0e0e0; }
    td { padding: 12px 8px; text-align: center; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; }
    td.present { background: #e8f5e8 !important; color: #137333; font-weight: 500; }
    td.absent { background: #fce8e6 !important; color: #d93025; font-weight: 500; }
    td:hover { background: #f0f7ff !important; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; margin: 20px 0; }
    .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; text-align: center; }
    .stat-number { font-size: 2.5em; font-weight: bold; margin: 10px 0; }
    .good { border-left: 5px solid #34a853; }
    .warning { border-left: 5px solid #fbbc04; }
    .danger { border-left: 5px solid #ea4335; }
    details { margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #1a73e8; }
    summary { cursor: pointer; font-weight: 600; padding: 10px; }
    .empty-state { text-align: center; color: #666; font-style: italic; padding: 40px; }
  </style>
</head>
<body>
  <h1>üìä Custom Attendance Manager</h1>

  <!-- Schedule Setup -->
  <div class="section">
    <h2>‚öôÔ∏è Define Weekly Schedule</h2>
    <div class="grid-cols-7" id="weeklySchedule">
      <!-- Populated by JS -->
    </div>
    <div style="margin-top: 20px;">
      <button onclick="saveSchedule()">üíæ Save Schedule</button>
    </div>
  </div>

  <!-- Add Days -->
  <div class="section">
    <h2>üìÖ Add Days</h2>
    <div class="grid-cols-2">
      <div>
        <label>New Day:</label>
        <input type="date" id="newDate">
        <select id="newWeekday">
          <option value="">Select Weekday</option>
        </select>
        <button onclick="addDayFromSchedule()">‚ûï Add Day</button>
      </div>
      <div>
        <label>Custom Hours:</label>
        <input type="number" id="customHours" placeholder="e.g. 7" min="1" max="12">
        <button onclick="addCustomDay()">‚ûï Custom Day</button>
      </div>
    </div>
  </div>

  <!-- Days List -->
  <div class="section" id="daysSection">
    <h2>‚úÖ Mark Attendance</h2>
    <div id="daysList" class="empty-state">Add your first day to start tracking!</div>
  </div>

  <!-- Stats -->
  <div class="section">
    <h2>üìà Live Stats</h2>
    <div class="stats-grid">
      <div class="stat-card good">
        <div class="stat-number" id="totalHours">0</div>
        <div>Total Hours</div>
      </div>
      <div class="stat-card good">
        <div class="stat-number" id="presentHours">0</div>
        <div>Present</div>
      </div>
      <div class="stat-card" id="pctCard">
        <div class="stat-number" id="currentPct">0%</div>
        <div>Attendance</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="absentHours">0</div>
        <div>Absent</div>
      </div>
    </div>
  </div>

  <!-- Advice -->
  <div class="section">
    <h2>üß† Smart Advice</h2>
    <div id="bunkAdvice" class="empty-state">Track some attendance for personalized bunk/attend recommendations.</div>
  </div>

  <script>
    const weekdays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    let schedule = {}; // {0:6, 1:7, ...}
    let daysData = []; // [{date:'2026-01-02', weekday:0, hoursCount:6, hours:[{present:true}]}]
    let targetPct = 75;

    function init() {
      loadData();
      renderWeeklySchedule();
      renderDaysList();
      updateStats();
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem('customAttendance') || '{}');
      schedule = data.schedule || {};
      daysData = data.days || [];
      targetPct = data.targetPct || 75;
    }

    function saveData() {
      localStorage.setItem('customAttendance', JSON.stringify({
        schedule, days: daysData, targetPct
      }));
    }

    function renderWeeklySchedule() {
      document.getElementById('weeklySchedule').innerHTML = weekdays.map((dayName, idx) => `
        <div>
          <label>${dayName}</label>
          <input type="number" value="${schedule[idx] || 0}" min="0" max="12" 
                 onchange="schedule[${idx}] = parseInt(this.value) || 0">
        </div>
      `).join('');
      
      document.getElementById('newWeekday').innerHTML = 
        '<option value="">Select...</option>' + weekdays.map((d,i) => `<option value="${i}">${d}</option>`).join('');
    }

    function saveSchedule() {
      weekdays.forEach((_, idx) => {
        const input = document.querySelector(`#weeklySchedule input:nth-child(${idx+1})`);
        if (input) schedule[idx] = parseInt(input.value) || 0;
      });
      saveData();
      alert('‚úÖ Schedule saved!');
    }

    function addDayFromSchedule() {
      const dateInput = document.getElementById('newDate');
      const weekdaySelect = document.getElementById('newWeekday');
      const date = dateInput.value;
      const weekday = parseInt(weekdaySelect.value);
      
      if (!date || weekday === '') {
        alert('‚ùå Select date and weekday');
        return;
      }
      
      if (daysData.find(d => d.date === date)) {
        alert('‚ùå Day already exists');
        return;
      }
      
      const hoursCount = schedule[weekday];
      if (!hoursCount || hoursCount <= 0) {
        alert('‚ùå Set hours for this weekday first');
        return;
      }
      
      daysData.push({
        date,
        weekday,
        hoursCount,
        hours: Array(hoursCount).fill().map(() => ({present: true}))
      });
      
      daysData.sort((a,b) => new Date(a.date) - new Date(b.date));
      renderDaysList();
      updateStats();
      saveData();
      dateInput.value = '';
      weekdaySelect.value = '';
    }

    function addCustomDay() {
      const date = prompt('Date (YYYY-MM-DD):');
      if (!date) return;
      
      const hours = parseInt(prompt('Hours for this day:', '6'));
      if (!hours || hours < 1) {
        alert('‚ùå Invalid hours');
        return;
      }
      
      if (daysData.find(d => d.date === date)) {
        alert('‚ùå Day exists');
        return;
      }
      
      daysData.push({
        date,
        weekday: -1, // custom
        hoursCount: hours,
        hours: Array(hours).fill().map(() => ({present: true}))
      });
      
      daysData.sort((a,b) => new Date(a.date) - new Date(b.date));
      renderDaysList();
      updateStats();
      saveData();
    }

    function renderDaysList() {
      const container = document.getElementById('daysList');
      if (daysData.length === 0) {
        container.innerHTML = '<div class="empty-state">üëÜ Add your first day above!</div>';
        return;
      }
      
      container.innerHTML = daysData.map(day => {
        const dayName = day.weekday >= 0 ? weekdays[day.weekday] : 'Custom';
        return `
          <details open>
            <summary>${day.date} (${dayName}, ${day.hoursCount} hrs) 
              <button class="danger" style="float:right;font-size:14px;padding:4px 8px;" 
                      onclick="deleteDay('${day.date}')">üóëÔ∏è</button>
            </summary>
            <table>
              <thead>
                <tr><th>Hour</th>${Array(day.hoursCount).fill().map((_,i) => `<th>${i+1}</th>`).join('')}</tr>
              </thead>
              <tbody>
                <tr>
                  ${Array(day.hoursCount).fill().map((hour, idx) => {
                    const cls = hour.present ? 'present' : 'absent';
                    const emoji = hour.present ? '‚úÖ' : '‚ùå';
                    return `<td class="${cls}" onclick="toggleAttendance('${day.date}', ${idx})" title="Click to toggle">
                      ${emoji} ${hour.present ? 'Present' : 'Absent'}
                    </td>`;
                  }).join('')}
                </tr>
              </tbody>
            </table>
          </details>
        `;
      }).join('');
    }

    function toggleAttendance(date, hourIdx) {
      const day = daysData.find(d => d.date === date);
      if (day) {
        day.hours[hourIdx].present = !day.hours[hourIdx].present;
        renderDaysList();
        updateStats();
        saveData();
      }
    }

    function deleteDay(date) {
      if (confirm(`Delete ${date}?`)) {
        daysData = daysData.filter(d => d.date !== date);
        renderDaysList();
        updateStats();
        saveData();
      }
    }

    function updateStats() {
      let total = 0, present = 0;
      daysData.forEach(day => {
        day.hours.forEach(h => {
          total++;
          if (h.present) present++;
        });
      });
      
      const absent = total - present;
      const pct = total ? Math.round((present / total) * 100) : 0;
      
      document.getElementById('totalHours').textContent = total;
      document.getElementById('presentHours').textContent = present;
      document.getElementById('absentHours').textContent = absent;
      document.getElementById('currentPct').textContent = pct + '%';
      
      const pctCard = document.getElementById('pctCard');
      if (pct >= targetPct) {
        pctCard.className = 'stat-card good';
      } else {
        pctCard.className = 'stat-card danger';
      }
      
      updateBunkAdvice(present, total);
    }

    function updateBunkAdvice(present, total) {
      if (total === 0) return;
      
      const t = targetPct / 100;
      const currPct = Math.round((present / total) * 100);
      const adviceEl = document.getElementById('bunkAdvice');
      
      if (currPct < targetPct) {
        const neededHours = Math.ceil((t * total - present) / (1 - t));
        adviceEl.innerHTML = `
          <div style="font-size:1.2em; margin-bottom:10px;">
            üö® Current: <strong>${currPct}%</strong> &lt; <strong>${targetPct}%</strong> target
          </div>
          <div style="font-size:1.5em; color:#ea4335;">
            Attend next <strong>${neededHours}</strong> hours straight to recover!
          </div>
        `;
      } else {
        const maxBunks = Math.floor(present / t - total);
        adviceEl.innerHTML = `
          <div style="font-size:1.2em; margin-bottom:10px;">
            ‚úÖ Current: <strong>${currPct}%</strong> ‚â• <strong>${targetPct}%</strong> target
          </div>
          <div style="font-size:1.5em; color:#34a853;">
            ‚úÖ Can safely bunk up to <strong>${Math.max(0, maxBunks)}</strong> more hours!
          </div>
        `;
      }
    }

    // Initialize
    init();
  </script>
</body>
</html>
